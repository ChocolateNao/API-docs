# Enka.Network - API

## Содержание

- [Начало работы](#начало-работы)
- [Структура данных](#структура-данных)
- [Определения](#определения)
- [Иконки и изображения](#иконки-и-изображения)
- [Локализации](#локализации)

## Начало работы

Вы можете использовать обёртки, созданные другими людьми, или использовать API напрямую. Это очень просто, поэтому совсем несложно вручную развернуть собственную логику данных на основе ответов. Самой большой проблемой является навигация по игровым данным, собранным с помощью дата-майнинга, и их согласование с возвращаемыми данными.

Смотрите [обёртки](#обёртки) для выбора нужного языка программирования.

## Прежде чем сделать запрос

Пара правил при использовании API:

1. Пожалуйста, не пытайтесь перебирать UID или выполнять массовые запросы, чтобы заполнить базу данных. Существуют сотни миллионов UID, и Вы просто не сможете этого сделать через этот API. Я могу предоставить пакетные данные позже.

2. Пожалуйста, устанавливайте свой уникальный заголовок `User-Agent` с запросами, чтобы я мог лучше их отслеживать и помогать, если необходимо.

3. На эндпоинтах UID предусмотрены динамические ограничения скорости — если запросы летят слишком быстро, Вы столкнетесь с более медленным временем отклика и, в конечном итоге, с кодом возврата 429. Это означает, что Вам нужно либо снизить скорость, либо связаться со мной, чтобы узнать, возможно ли увеличить лимит скорости. В большинстве случаев это не нужно и является результатом неоптимизированного кода.

4. В этом примечании, все запросы UID возвращают поле `ttl` - это поле означает "секунд до следующего запроса Showcase для этого UID". Пока он не истечет, эндпоинт будет возвращать кешированные данные, но Вы все равно будете расходовать лимит скорости, если неоднократно попадёте на это. Попробуйте либо кэшировать данные с тайм-аутом `ttl` по запросу, либо запретить запросы к UID до тех пор, пока не истечет его `ttl`. Для этого рекомендую использовать Redis.

Если Вы испытываете трудности при работе с данными, присоединяйтесь к [Discord серверу](https://discord.gg/PcSZr5sbn3) для получения помощи.

## Список API

### UID эндпоинты

#### Получение данных Showcase с полной информацией об игроке

> https://enka.network/api/uid/618285856/

Ответ будет содержать `playerInfo` и `avatarInfoList`. `playerInfo` содержит основные данные об игровом аккаунте. Если `avatarInfoList` отсутствует, это значит, что витрина этой учетной записи либо закрыта, либо не заполнена персонажами.

#### Получение только информации об игроке

> https://enka.network/api/uid/618285856/?info

Прикрепляя `?info` к запросу, Вы получите только `playerInfo`. Основной запрос также всегда пытается получить `avatarInfoList`; если Вам нужен только `playerInfo`, используйте этот эндпоинт - получится намного быстрее, чем попытка получения полных данных.

Кроме того, оба ответа будут содержать объект «владелец» (`owner`), если:

1. У пользователя есть аккаунт на сайте;
2. Пользователь добавил свой UID в профиль;
3. Пользователь подтвердил это;
4. Пользователь установил видимость на «публичную».

Подробнее об учетных записях пользователей ниже.

#### Коды ответов HTTP

Убедитесь, что Вы правильно обрабатываете их в своем приложении.

```
400 = Неверный формат UID
404 = Игрок не существует (так сказали сервера MHY)
424 = Обслуживание игры / все сломалось после обновления
429 = Ограничена скорость (либо моим сервером, либо сервером MHY)
500 = Общая ошибка сервера
503 = Я сильно облажался
```

### Эндпоинты профиля

На сайте можно создать аккаунт (профиль) и привязать к нему несколько игровых аккаунтов. Затем, с помощью кода подтверждения, помещенного в их подпись, пользователи должны подтвердить, что это их учетная запись — таким образом мы можем гарантировать, что учетная запись принадлежит им.

Пользователи могут делать «снэпшоты» сборок под произвольными именами, называемыми «сохраненными сборками».

> https://enka.network/api/profile/Algoinde/

Получает информацию о пользователе

> https://enka.network/api/profile/Algoinde/hoyos/

Получает список «hoyos» — учетные записи Genshin и их метаданные. Это возвращает только `verified` и `public` учетные записи (пользователи могут скрывать учетные записи; неподтвержденные учетные записи скрыты по умолчанию). Каждый ключ в ответе является уникальным идентификатором hoyo, который вам нужно использовать для последующих запросов, чтобы фактически получить информацию о персонажах/сборках.

> https://enka.network/api/profile/Algoinde/hoyos/4Wjv2e/

Возвращает метаданные для одного hoyo.

> https://enka.network/api/profile/Algoinde/hoyos/4Wjv2e/builds/

Возвращает сохраненные сборки для данного hoyo. Это объект массивов, где ключом является `avatarId` персонажа, а объекты в массивах — разные сборки для данного персонажа в произвольном порядке (однако, у них есть поле `order`, по которому нужно упорядочивать для отображения).

Если в сборке есть поле `live: true`, это значит, что это не «сохраненная» сборка, а та, что была получена из витрины, когда была нажата кнопка «обновить». При обновлении все старые `live` сборки удаляются и создаются новые. Только пользователь решает, когда выполнять это обновление — эти данные НЕ будут актуальными.

Как указано в разделе [UID эндпоинты](#uid-эндпоинты), когда происходит запрос UID, Вы можете получить объект `owner`. Можно создать URL-адрес, используя эти поля в объекте:

`https://enka.network/api/profile/{owner.username}/hoyos/{owner.hash}/builds/`

## Структура данных

| Название | Описание |
| :--- | :---------- |
| [playerInfo](#playerinfo) | Информация профиля |
| [avatarInfoList](#avatarinfolist) | Список подробной информации по каждому персонажу из витрины |

### playerInfo

Базовые данные персонажей по ID можно получить из [store/characters.json](https://github.com/EnkaNetwork/API-docs/blob/master/store/characters.json).  <br />
Для дополнительной информации можно обратиться к [данным персонажей](https://gitlab.com/Dimbreath/AnimeGameData/-/blob/master/ExcelBinOutput/AvatarExcelConfigData.json).

| Название | Описание |
| :--- | :--------- |
| nickname | Никнейм игрока |
| signature | Подпись ппрофиля |
| worldLevel | Уровень мира игрока |
| namecardId | ID именной карточки профиля |
| finishAchievementNum | Количество полученных достижений |
| towerFloorIndex | Этаж витой бездны |
| towerLevelIndex | Комната витой бездны |
| [showAvatarInfoList](#showavatarinfolist) | Список ID персонажей и уровней |
| showNameCardIdList | Список ID именных карточек |
| profilePicture.avatarId | ID персонажа на изображении профиля |

#### showAvatarInfoList

| Название | Описание |
| :--- | :--------- |
| avatarId | ID персонажа |
| level | Уровень персонажа |
| costumeId | ID скина персонажа. Проверьте `"Костюмы"` в [store/characters.json](https://github.com/EnkaNetwork/API-docs/blob/master/store/characters.json) |

### avatarInfoList

Базовые данные персонажей по ID можно получить из [store/characters.json](https://github.com/EnkaNetwork/API-docs/blob/master/store/characters.json).  <br />
Для дополнительной информации можно обратиться к [данным персонажей](https://gitlab.com/Dimbreath/AnimeGameData/-/blob/master/ExcelBinOutput/AvatarExcelConfigData.json).

| Название | Описание |
| :--- | :---------- |
| avatarID | ID персонажа |
| talentIdList | Список ID созвездий <br /> Нет данных, если 0 созвездий |
| [propMap](#propmap) | Список свойств информации о персонаже |
| fightPropMap -> `{id: value}` |  `Map` боевых свойств персонажа. <br />Проверьте [определения для ID](#fightprop)|
| skillDepotId | ID набора навыков персонажа <br />[Данные умений](https://gitlab.com/Dimbreath/AnimeGameData/-/blob/master/ExcelBinOutput/AvatarSkillDepotExcelConfigData.json) ->     `"id"`|
| inherentProudSkillList | Список разблокированных ID навыков <br />[Данные умений](https://gitlab.com/Dimbreath/AnimeGameData/-/blob/master/ExcelBinOutput/AvatarSkillDepotExcelConfigData.json) -> `"inherentProudSkillOpens"` |
| skillLevelMap -> `{skill_id: level}`| `Map` уровней навыков <br /> [Данные умений](https://gitlab.com/Dimbreath/AnimeGameData/-/blob/master/ExcelBinOutput/AvatarSkillDepotExcelConfigData.json) -> `"inherentProudSkillOpens"` |
| [equipList](#equiplist) | Список снаряжения: Оружие, Артефакты |
| fetterInfo.expLevel  | Уровень дружбы персонажа |

#### propMap

| Название | Описание |
| :--- | :--------- |
| type | ID типа свойства, проверьте [определения для ID](#prop) |
| ival | Игнорируйте это |
| val  | Значение свойства |

#### equipList

| Название | Описание |
| :--- | :--------- |
| itemId | ID снаряжения <br /> [Данные артефактов](https://gitlab.com/Dimbreath/AnimeGameData/-/blob/master/ExcelBinOutput/ReliquaryExcelConfigData.json) -> `"id"` <br /> [Данные оружия](https://gitlab.com/Dimbreath/AnimeGameData/-/blob/master/ExcelBinOutput/WeaponExcelConfigData.json) -> `"id"` |
| [weapon](#weapon) `[Только оружие]` | Информация о базе оружия  |
| [reliquary](#reliquary) `[Только артефакт]` | Информация о базе артефакта  |
| [flat](#flat) | Подробная информация о снаряжении |

#### weapon

Для получения дополнительной информации об оружии можно обратиться к [данным оружий](https://gitlab.com/Dimbreath/AnimeGameData/-/blob/master/ExcelBinOutput/WeaponExcelConfigData.json)

| Название | Описание |
| :--- | :---------- |
| level | Уровень оружия |
| promoteLevel | Уровень возвышения оружия |
| affixMap | Уровень пробуждения оружия `[0-4]` |

#### reliquary

Для получения дополнительной информации об артефактах можно обратиться к [данным артефактов](https://gitlab.com/Dimbreath/AnimeGameData/-/blob/master/ExcelBinOutput/ReliquaryExcelConfigData.json)

| Название | Описание |
| :--- | :---------- |
| level | Уровень артефакта `[1-21]` |
| mainPropId | ID основного стата артефакта <br /> [Данные основных статов](https://gitlab.com/Dimbreath/AnimeGameData/-/blob/master/ExcelBinOutput/ReliquaryMainPropExcelConfigData.json) |
| appendPropIdList | Список ID подстатов артефакта <br /> [Данные подстатов](https://gitlab.com/Dimbreath/AnimeGameData/-/blob/master/ExcelBinOutput/ReliquaryAffixExcelConfigData.json) |

#### flat

| Название | Описание |
| :--- | :---------- |
| nameTextHashMap | Хэш для названия снаряжения <br /> Проверьте [локализации](#локализации) |
| setNameTextHashMap `[Только артефакт]`| Хэш для названия набора артефактов <br /> Проверьте [локализации](#локализации)|
| rankLevel | Уровень редкости снаряжения |
| [reliquaryMainstat](#reliquarymainstat-reliquarysubstats-weaponstats) `[Только артефакт]` | Основной стат артефакта |
| [reliquarySubstats](#reliquarymainstat-reliquarysubstats-weaponstats) `[Только артефакт]` | Список подстатов артефакта |
| [weaponStats](#reliquarymainstat-reliquarysubstats-weaponstats) `[Только оружие]`| Список статов оружия: Базовая слиа атаки, подстат |
| [itemType](#itemtype) | Тип снаряжения: оружие или артефакт |
| icon | Название иконки снаряжения <br /> [Использование названий иконок](#иконки-и-изображения)|
| [equipType](#equiptype) `[Только артефакт]` | Тип артефакта |

#### reliquaryMainstat, reliquarySubstats, weaponStats

| Название | Описание |
| :--- | :---------- |
| mainPropId / appendPropID | Название добавочного свойства снаряжения. Проверьте [определния имён](#appendprop)|
| propValue | Значение свойства |

## Определения

### Prop

| Тип | Описание |
| :--: | :---------- |
| 1001 | Опыт |
| 1002 | Возвышение |
| 4001 | Уровень |

### FightProp

| Тип | Описание |
| :--: | :---------- |
| 1 | Базовое HP |
| 2 | HP |
| 3 | HP% |
| 4 | Базовая сила атаки |
| 5 | Сила атаки |
| 6 | Сила атаки % |
| 7 | Базовая защита |
| 8 | Защита |
| 9 | Защита % |
| 10 | Базовая скорость атаки |
| 11 | Скорость атаки % |
| 20 | Шанс крит. попадания |
| 22 | Крит. урон |
| 23 | Восст. энергии |
| 26 | Бонус лечения |
| 27 | Бонус получаемого лечения |
| 28 | Мастерство стихий |
| 29 | Физ. сопротиление |
| 30 | Бонус физ. урона |
| 40 | Бонус Пиро урона |
| 41 | Бонус Электро урона |
| 42 | Бонус Гидро урона |
| 43 | Бонус Дендро урона |
| 44 | Бонус Анемо урона |
| 45 | Бонус Гео урона |
| 46 | Бонус Крио урона |
| 50 | Пиро сопротивление |
| 51 | Электро сопротивление |
| 52 | Гидро сопротивление |
| 53 | Дендро сопротивление |
| 54 | Анемо сопротивление |
| 55 | Гео сопротивление |
| 56 | Крио сопротивление |
| 70 | Потребление Пиро энергии |
| 71 | Потребление Электро энергии |
| 72 | Потребление Гидро энергии |
| 73 | Потребление Дендро энергии |
| 74 | Потребление Анемо энергии |
| 75 | Потребление Крио энергии |
| 76 | Потребление Гео энергии |
| 80 | Снижение времени отката |
| 81 | Прочность щита |
| 1000 | Текущая Пиро энергия |
| 1001 | Текущая Электро энергия |
| 1002 | Текущая Гидро энергия |
| 1003 | Текущая Дендро энергия |
| 1004 | Текущая Анемо энергия |
| 1005 | Текущая Крио энергия |
| 1006 | Текущая Гео энергия |
| 1010 | Текущее HP |
| 2000 | Максимальное HP |
| 2001 | Сила атаки |
| 2002 | Защита |
| 2003 | Скорость атаки |
| 3025 | Крит. шанс элементальной реакции |
| 3026 | Крит. урон элементальной реакции |
| 3027 | Крит. шанс элементальной реакции (Перегрузка) |
| 3028 | Крит. урон элементальной реакции (Перегрузка) |
| 3029 | Крит. шанс элементальной реакции (Рассеивание) |
| 3030 | Крит. урон элементальной реакции (Рассеивание) |
| 3031 | Крит. шанс элементальной реакции (Заряжен) |
| 3032 | Крит. урон элементальной реакции (Заряжен) |
| 3033 | Крит. шанс элементальной реакции (Сверхпроводник) |
| 3034 | Крит. урон элементальной реакции (Сверхпроводник) |
| 3035 | Крит. шанс элементальной реакции (Горение) |
| 3036 | Крит. урон элементальной реакции (Горение) |
| 3037 | Крит. шанс элементальной реакции (Заморозка (Разбит)) |
| 3038 | Крит. урон элементальной реакции (Заморозка (Разбит)) |
| 3039 | Крит. шанс элементальной реакции (Бутонизация) |
| 3040 | Крит. урон элементальной реакции (Бутонизация) |
| 3041 | Крит. шанс элементальной реакции (Цве­тение) |
| 3042 | Крит. урон элементальной реакции (Цве­тение) |
| 3043 | Крит. шанс элементальной реакции (Веге­тация) |
| 3044 | Крит. урон элементальной реакции (Веге­тация) |
| 3045 | Базовый крит. шанс элементальной реакции |
| 3046 | Базовый крит. урон элементальной реакции |

### ItemType

| Название | Описание |
| :--- | :---------- |
| ITEM_WEAPON | Оружие |
| ITEM_RELIQUARY | Артефакт |

### EquipType

| Название | Описание |
| :--- | :---------- |
| EQUIP_BRACER | Цветок жизни |
| EQUIP_NECKLACE | Перо смерти |
| EQUIP_SHOES | Пески времени |
| EQUIP_RING | Кубок пространства |
| EQUIP_DRESS | Корона разума |

### AppendProp

| Название | Описание |
| :--- | :---------- |
| FIGHT_PROP_BASE_ATTACK `[Оружие]` | Базовая сила атаки |
| FIGHT_PROP_HP | Целочисленное HP |
| FIGHT_PROP_ATTACK | Целочисленная сила атаки |
| FIGHT_PROP_DEFENSE | Целочисленная защита |
| FIGHT_PROP_HP_PERCENT | HP% |
| FIGHT_PROP_ATTACK_PERCENT | Сила атаки % |
| FIGHT_PROP_DEFENSE_PERCENT | Защита % |
| FIGHT_PROP_CRITICAL | Шанс крит. попадания |
| FIGHT_PROP_CRITICAL_HURT | Крит. урон |
| FIGHT_PROP_CHARGE_EFFICIENCY | Восст. энергии |
| FIGHT_PROP_HEAL_ADD | Бонус лечения |
| FIGHT_PROP_ELEMENT_MASTERY | Мастерсто стихий |
| FIGHT_PROP_PHYSICAL_ADD_HURT | Бонус физ. урона |
| FIGHT_PROP_FIRE_ADD_HURT | Бонус Пиро урона |
| FIGHT_PROP_ELEC_ADD_HURT | Бонус Электро урона |
| FIGHT_PROP_WATER_ADD_HURT | Бонус Гидро урона |
| FIGHT_PROP_WIND_ADD_HURT | Бонус Анемо урона |
| FIGHT_PROP_ICE_ADD_HURT |  Бонус Крио урона |
| FIGHT_PROP_ROCK_ADD_HURT | Бонус Гео урона |
| FIGHT_PROP_GRASS_ADD_HURT | Бонус Дендро урона |

## Иконки и изображения

Вы можете получить иконки персонажей, оружия и артефактов при помощи Enka, по URL `https://enka.network/ui/[icon_name].png`.  
Обычно название иконки начинается с `"UI_"` или `"Skill_"` для [талантов персонажей](#персонажи-таланты-и-созвездия).  
Например, https://enka.network/ui/UI_AvatarIcon_Side_Ambor.png.

### Оружия и артефакты

Перейдите во [flat](#flat) и найдите `icon`.

### Персонажи, таланты и созвездия

Перейдите в [store/characters.json](https://github.com/EnkaNetwork/API-docs/blob/master/store/characters.json) и ищите всё, что связано с «UI_XXXXXX» или «Skill_XXXXXX» по ID персонажа.

## Локализации

Вы можете заметить `"NameTextMapHash"` в [store/characters.json](https://github.com/EnkaNetwork/API-docs/blob/master/store/characters.json), `"nameTextHashMap"` и `"setNameTextHashMap"` в [flat](#flat) который можно было бы использовать в качестве ключа для получения основных данных о локализации персонажей, оружия и артефактов из [store/loc.json](https://github.com/EnkaNetwork/API-docs/blob/master/store/loc.json).  
Вы также можете получить данные локализации [AppendProp](#appendprop) используя имя свойства в качестве ключа - `"FIGHT_PROP_HP"`, `"FIGHT_PROP_HEAL_ADD"` и так далее.

Для получения дополнительной информации об именах, описаниях и так далее, проверьте [TextMap Data](https://gitlab.com/Dimbreath/AnimeGameData/-/tree/master/TextMap), включает только языки, поддерживаемые игрой.

## Обёртки

TS/JS - https://www.npmjs.com/package/enkanetwork.js - [Jelosus1](https://github.com/Jelosus2)

TS/JS - https://github.com/yuko1101/enka-network-api - [yuko1101](https://github.com/yuko1101)

Rust - https://github.com/eratou/enkanetwork-rs - [eratou](https://github.com/eratou)

Python - https://github.com/mrwan200/enkanetwork.py - [mrwan200](https://github.com/mrwan200)
